<!DOCTYPE html>
<HTML>
<HEAD>
    <link href="bootstrap-3.1.1-dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="bootstrap-3.1.1-dist/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="theme.css" rel="stylesheet">
    <link href="impromptu.css" rel="stylesheet">
    <link href="bootstrap-select.css" rel="stylesheet">

<style>
/* temporary style elements, move to dedicated CSS file later */

.show-item:hover {
    background-color: rgba(153,204,248,0.6);
}
.show-item:active {
    background-color: rgba(153,204,248,1);
}
.modification-tool:hover {
}
.modification-tool:active {
}

</style>

</HEAD>

<BODY role="document">

    <div class="container panel-container" role="main">

        
        <div id="logo" align="center"><img src="wushumushu_logo.png" style="width:40%;"></div>

        <div id="instructions" align="center" style="position:relative; top: 20px; color: red;"></div>

        <div class="col-md-6 col-md-offset-3" style="position: relative; top: 50px;">
            <div class="panel panel-default">


                <div class="panel-heading">
                    <div class="container-fluid">
                    <!-- Brand and toggle get grouped for better mobile display -->
                        <ul class="nav navbar-nav navbar-left" style="font-size:26pt;">Shows</ul>
                        <ul class="nav navbar-nav navbar-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default" id="new-show-btn">
                                    Add New Show
                                </button>
                                <button type="button" class="btn btn-default" id="edit-shows-btn">
                                    Edit Shows
                                </button>
                            </div>
                        </ul>
                    </div><!--container-fluid -->
                </div><!-- end panel heading -->


                <ul class="list-group" id="all-shows"><!-- part of "panel panel-default" class -->
                    
                    <!--
                    <li class="list-group-item show-item">

                        
                        show 1
                        <div class="pull-right">
                            <button type="button" class="btn btn-default btn-xs">
                                <span class="glyphicon glyphicon-pencil"></span>
                            </button>
                            <button type="button" class="btn btn-default btn-xs">
                                <span class="glyphicon glyphicon-remove"></span>
                            </button>
                        </div>


                        <span style="float:right;margin-right:0px;">
                            <div id="date">Date</div>
                        </span>
                        <span style="position:relative;margin-right:40px;">
                            Location
                        </span>
                    

                        <table><tr>
                            <td>Showsfsdfsd 1</td>
                            <td>Location<br>Datsdfse</td>
                        </tr></table>
                    </li>
                    -->



                    <!--
                    <li class="list-group-item show-item">
                        <table><tr>
                            <td>Showsfsdfsd 1</td>
                            <td>Location<br>Datsdfse</td>
                        </tr></table>

                    </li>
                    -->

                </ul><!-- end list-group of shows -->


            </div><!-- end default panel -->


        </div><!-- end col-md-6 col-md-offset-3 shows box -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="bootstrap-3.1.1-dist/js/bootstrap.min.js"></script>
    <!--<script src="bootstrap-3.1.1-dist/assets/js/docs.min.js"></script>-->
    <script src="jquery-1.9.0.min.js"></script>
    <script src="impromptu.min.js"></script>
    <script src="bootstrap-select.min.js"></script>

    <script type="text/javascript">

        // global variable for generating UIDs
        var ticket = 0;

        // global variable to activate edit/delete mode
        var editing = false;

        // global storage for shows and their information
        // this may be replaced by a backend database later
        //
        // keys (string type) in show_data are the UIDs
        // values (dict type) are another dictionary with the following properties (example below)
        // * note that UID is replicated in the inner dictionary as well
        //      keys (string type)      values (string type)
        //      ------------------      --------------------
        //      UID                     0
        //      name                    Elements
        //      date                    Sat 4/19/2014
        //      timeStart               7 PM
        //      timeEnd                 9 PM
        //      location                Jewett Auditorium
        var show_data = {};

        // generates the show dictionary data structure
        function generateShowDS(UID, showName, showDate, showTimeStart, showTimeEnd, showLocation) {
            var DS = {};
            DS['UID'] = UID;
            DS['name'] = showName;
            DS['date'] = showDate;
            DS['timeStart'] = showTimeStart;
            DS['timeEnd'] = showTimeEnd;
            DS['location'] = showLocation;
            return DS;
        }

        // modifies a show based on new properties (UID cannot be changed)
        // changes the local storage properties and the div view
        function modifyShow(new_showName, new_showDate, new_showTimeStart, new_showTimeEnd, new_showLocation) {

        }

        // generates a string for the div visually depicting the show item
        function generateShowDiv(showDS) {
            var UID = showDS['UID'];
            var showName = showDS['name'];
            var showDate = showDS['date'];
            var showTimeStart = showDS['timeStart'];
            var showTimeEnd = showDS['timeEnd'];
            var showLocation = showDS['location'];
            
            var showTimeSpan = '<i>(No times)</i>';
            if (showTimeStart != "" && showTimeEnd != "") { showTimeSpan = showTimeStart + ' - ' + showTimeEnd; }
            if (showTimeStart != "" && showTimeEnd == "") { showTimeSpan = showTimeStart; }
                
            if (showDate != "") { showDate = showDate + '<br>'; }
            else { showDate = '<i>(No date)</i><br>'; }

            if (showLocation != "") { showLocation = showLocation + '<br>'; }
            else { showLocation = '<i>(No location)</i><br>'; }

            return      '<div id="'+UID+'"><li class="list-group-item show-item">'
                    +   '<table style="width:100%;margin0px;"><tr>'
                    +   '<td style="vertical-align:top;font-size:22pt;">'
                    +   '<b><div id="'+UID+'-name">'+showName+'</div></b>'
                    +   '</td><td style="text-align:right;vertical-align:top;width:40%;">'
                    +   '<div id="'+UID+'-location">'+showLocation+'</div>'
                    +   '<div id="'+UID+'-date">'+showDate+'</div>'
                    +   '<div id="'+UID+'-timespan">'+showTimeSpan+'</div>'
                    +   '</td></tr></table></li></div>';
        }

        var rowSpacing = '<tr style="height:20px;"></tr>'
        var showDialogFormatOption0 =
        '<table class="add-show-dialog""><tr><td style="width:45%;"><label>Show name</label></td><td><input type="text" name="showName" value="Elements"></td></tr>' +
        rowSpacing +
        '<tr><td><label>Date</label></td><td><input type="text" name="showDate" value="Sat 4/19/2014"></td></tr>' +
        rowSpacing +        
        '<tr><td><label>Start time</label></td><td><input type="text" name="showTimeStart" value="7 PM">' +
        rowSpacing +
        '<tr><td><label>End time</label></td><td><input type="text" name="showTimeEnd" value="9 PM"></td></tr>' +
        rowSpacing +
        '<tr><td><label>Location</label</td><td><input type="text" name="showLocation" value="Jewett Auditorium"></td></tr></table>';

        $("#edit-shows-btn").click(function() {
            // toggle the global flag
            if (editing) {
                editing = false;
                $("#edit-shows-btn").html('Edit Shows');
                $("#instructions").html('');
            } else {
                editing = true;
                $("#edit-shows-btn").html('<div style="color:red;">Turn off editing</div>');
                $("#instructions").html('Click on a show to edit it');
            }

        });

        $("#new-show-btn").click(function() {
            var linkPrompt = {
                state0: {
                    title: 'Add new show <b>[USING CANNED INPUTS]</b>',
                    html: showDialogFormatOption0,
                    buttons: { Cancel: -1, Done: 1 },
                    focus: 1,
                    submit: function(e,v,m,f) {
                        if (f.showName != "" && v == 1) {
                            //-------------------------------------------------------
                            //  create new show directory in the backend model here
                            //  
                            //  initialize acts page with proper information if not done so before
                            //-------------------------------------------------------
                            
                            // UID is a unique integer string representing each show item
                            // The UID implementation may be changed when building the backend
                            var UID = (ticket++).toString();

                            var showDS = generateShowDS(UID, f.showName, f.showDate, f.showTimeStart, f.showTimeEnd, f.showLocation);
                            
                            // add the show data structure to the global log
                            show_data[UID] = showDS;

                            $("#all-shows").append(generateShowDiv(showDS));
                            $("#"+UID).click(function() {
                                if (editing) {
                                    
                                    // currently using local javascript storage show_data
                                    // think of a switch to database during backend implementation
                                    var initShowDS = show_data[UID];
                                    var initShowName = initShowDS['name'];
                                    var initShowDate = initShowDS['date'];
                                    var initShowTimeStart = initShowDS['timeStart'];
                                    var initShowTimeEnd = initShowDS['timeEnd'];
                                    var initShowLocation = initShowDS['location'];

                                    var editPrompt = {
                                        state0: {
                                            title: 'Currently editing show: ' + initShowName,
                                            html: showDialogFormatOption0,
                                            buttons: { 'Delete this show': -10, 'Cancel': -1, 'Save changes': 1 },
                                            focus: 1,
                                            submit: function(e1,v1,m1,f1) {
                                                if (v1 == 1) {
                                                    //$("#"+UID+'-name').html('hi');
                                                    e1.preventDefault();
                                                    $.prompt.close();
                                                }
                                                else if (v1 == -1) {
                                                    e1.preventDefault();
                                                    $.prompt.close();
                                                }
                                                else if (v1 == -10) {
                                                    e1.preventDefault();
                                                    $.prompt.goToState('deleteState',false,e1); // goto state1
                                                }

                                            }
                                        }, // end state0 (default edit panel)

                                        'deleteState': {
                                            title: 'Delete show',
                                            html: 'Are you sure you want to delete the show: <span style="color:red;">'
                                                  +initShowName+'</span><br><br>This action cannot be undone<br><br>',
                                            buttons: { 'Yes, delete this show' : -1, 'No, keep this show' : 1 },
                                            focus: 1,
                                            submit: function(e1,v1,m1,f1) {
                                                if (v1 == -1) {
                                                    $("#"+UID).remove(); // remove the div view
                                                    delete show_data['UID']; // remove data structure from storage
                                                }
                                            }


                                        } // end deleteSlate

                                    }; // end editPrompt

                                    $.prompt(editPrompt);

                                } else {
                                    window.location.href = "acts.html";
                                }
                            }); // end #+UID click function (def depends on if edit mode on or off)


                        } // end if block checking f.showName != "" && v==1
                        e.preventDefault();
                        $.prompt.close();

                    } // end outer submit function
                } // end outer state0
            }; // end outer linkPrompt definition
            $.prompt(linkPrompt);


        }); // end #new-show-btn click function
    
    </script>

</BODY>
</HTML>
