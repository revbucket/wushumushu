<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    
    <title>WushuMushu Edit</title>
    
    <!-- Bootstrap core CSS -->
    <link href="bootstrap-3.1.1-dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="bootstrap-3.1.1-dist/css/bootstrap-theme.min.css" rel="stylesheet">
    
    <!-- Custom styles for this template -->
    <link href="theme.css" rel="stylesheet">
    
    <!-- Stylesheet for impromptu -->
    <link href="impromptu.css" rel="stylesheet">
    <!--- Stylesheet for select forms -->
    <link href="bootstrap-select.css" rel="stylesheet">

    </head>
    
    <body role="document">
        
        <div class="container panel-container" role="main">
            
            <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
                <div class="container-fluid">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <ul class="nav navbar-nav navbar-left">
                        <ol class="breadcrumb list inline">
                          <li><a href="#">Show</a></li>
                          <li><a href="#">Act</a></li>
                          <li class="active">Current Section</li><!-- or could be Edit -->
                        </ol>
                    </ul>
            
                    <ul class="nav navbar-nav navbar-right">
                        <div class="btn-group">
                          <button type="button" class="btn btn-default">Edit</button>
                          <button type="button" class="btn btn-default">View</button>
                        </div>
                    </ul>
              
                </div><!--container-fluid -->
            </nav>
            
            <div class="row" id="song-pane">
                <div class="col-sm-7">
                    
                    <!-- Reference: view-source:http://labs.abeautifulsite.net/demos/bootstrap-file-inputs/ -->
                    <div class="input-group" style="padding-bottom:2em;">
                        <span class="input-group-btn">
                            <span class="btn btn-default btn-file">
                                Add Song<input type="file" multiple>
                            </span>
                        </span>
                        <input type="text" class="form-control" readonly>
                    </div>
                    
                </div>
            </div>
            
            <div class="row" id="main-pane">

                <!-- Sections -->
                <div class="col-sm-3">
                    <div class="panel panel-default">
                      <div class="panel-heading">Sections</div>
                    
                      <!-- List group -->
                      <ul class="list-group">
                        <li class="list-group-item">Section 1</li>
                        <li class="list-group-item">Section 2</li>
                      </ul>
                    
                     
                      <div class="input-group">
                          <input type="text" class="form-control">
                          <span class="input-group-btn">
                            <button class="btn btn-default" type="button">Add</button>
                          </span>      
                      </div>
                   
                        
                    </div>
                </div>
                
                <!-- Moves container -->
                <div class="col-sm-4">
                    <div class="panel panel-default">
                      <div class="panel-heading">Moves</div>
                    
                      <!-- List group -->
                      <ul class="list-group">
                        <li class="list-group-item">Move 1</li>
                        <li class="list-group-item">Move 2</li>
                      </ul>
                    
                      <form class="form-horizontal" role="form">
                          <div class="form-group">
                            <div class="col-sm-12">
                                <label class="sr-only" for="add-move">Add Move</label>
                                <textarea class="form-control" id="add-move" rows="3"></textarea>
                            </div>
                          </div>
                          
                          <div class="form-group">
                            <div class="col-sm-offset-5">
                                <button type="submit" class="btn btn-default">Add</button>
                            </div>
                          </div>
                      </form>
                        
                    </div>
                </div>
                
                <!-- Right side of the panel -->

                <div class="col-sm-5">
                    <!-- Weapons Group Buttons -->
                    <div class="btn-group btn-group-justified" id = "weaponList">
		      <div class = "btn-group" id = "edit-weapon-btn">

			<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			  Edit <span class="caret"></span>
			</button>
			<ul class="dropdown-menu dropdown-menu-right" role="menu">
			  <li><a id = "new-weapon-button"> New weapon </a></li>
			  <li class="divider"></li>
			  <li><a id = "delete-weapon-button">Delete Weapon</a></li>
                        </ul> 
	              </div>

                    </div>
                    
                    <!-- Add Youtube player here -->
            
                    <div class="" style="padding-top:2em;">
                        <div class = "panel panel-primary" id = "selectWeaponPanel">
			   <div class="panel-heading"></div>
                           <div class="panel-body">
                              Add or select a weapon group first, then add a video!
                           </div>
			</div>

		        <div class= "panel-primary panel" id = "newDivPanel">
			  <div class = "panel-heading"> </div>
                           <div class="panel-body">
                            <div class= "btn-group btn-group-lg" style="margin: 10px 100px 20px 100px; text-align: center;">
			        <button type="button" class="btn btn-default" id="linkButton">Insert link to youtube video</button>
			    </div>
			    
                            <div class= "btn-group btn-group-lg" style="left:15%;  text-align:center;">
			        <button type="button" class="btn btn-default" id="uploadButton">Upload a video from your computer</button>
			    </div>

                           </div>
                        </div>
                        <div class="vid" id = "vidPanel">
                            <iframe width="560" height="315" id="youtubePlugin" src="http://www.youtube.com/embed/WzUxxqSMpB0?rel=0" frameborder="0" allowfullscreen></iframe>
                        </div>
                    </div>
                        
                </div><!-- col-sm-6 -->
                
            </div><!-- row -->

   
        </div><!-- panel-container -->
        
        <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="bootstrap-3.1.1-dist/js/bootstrap.min.js"></script>
    <script src="bootstrap-3.1.1-dist/assets/js/docs.min.js"></script>
    <script src="jquery-1.9.0.min.js"></script>
    <script src="impromptu.min.js"></script>
    <script src="bootstrap-select.min.js"></script>
    <script type = "text/javascript">
      /*
      Data model for GR4:
      Each act has ONE master dictionary that holds all information organized as follows
      Dict[sectionName] -> MoveDict
      MoveDict[moveName] -> TextWeaponTuple
      TextWeaponTuple = [MoveText, WeaponList]
      WeaponList = [(weapon1, videoURL), ... (weaponX, videoURL)]
      */
      var actDictionary = {'section1': {'move1': ['This is the move text to display', {'Sword': "http://www.youtube.com/embed/WzUxxqSMpB0?rel=0", 'Staff': null, 'Fist': null}], 
                                        'move2': null},
                           'section2': null};
      var currentSection = 'section1';
      var currentMove = 'move1';
      var currentWeapon = 'Sword';
      /*Video section handling */

      var getId = function(url) {
         var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
         var match = url.match(regExp);
         if (match && match[2].length == 11) {
             return match[2];
         } else {
            return 'error';
         }
      };

      var renderVideoPanel = function() {
        if (currentWeapon == null) {
          $("#selectWeaponPanel").show();
          $("#newDivPanel").hide();
          $("#vidPanel").hide();
        } else{
        var videoURL = actDictionary[currentSection][currentMove][1][currentWeapon];
        if (videoURL == null) {
          $("#selectWeaponPanel").hide();
          $("#newDivPanel").show();
          $("#vidPanel").hide();


        } else {
          $("#selectWeaponPanel").hide();
          $("#newDivPanel").hide();
          $("#vidPanel").show();

        }
        }
      var addLink = function() {
        $.prompt("HelloWorld");
      }
      
      };
      /*Weapons group handling */
      var populateWeaponList = function(section, move) {
          $(".weapon-div").remove();
          $.each(actDictionary[section][move][1], function(key, value) {
                 var newIDDiv = key + "-weapon-div";
                 var newIDString = key + "-weapon-btn";
                 var newButton = jQuery('<div/>', {id: newIDDiv,
                                        class: 'btn-group weapon-div'}).html('<button type="button" class="btn btn-default weapon-btn" id="'+newIDString + '">'+ 
                                    key + '</button>');
                 $('#edit-weapon-btn').before(newButton);
          }); 
             $(".weapon-btn").click( function(e) {clickWeaponButton(e.target.id)});
      };
       
      var clickWeaponButton = function(id){
         console.log(id);

         $(".weapon-btn").removeClass("btn-info");
         $("#"+id).addClass("btn-info");         
         currentWeapon = id.split('-')[0];
         renderVideoPanel();
         
      };

      $('#new-weapon-button').click( function(e) {

         var newWeapon = null;
         var newWeaponPrompt = {
                state0: {
		    title: 'New Weapon',
                    html:'<label>Weapon Name <input type="text" name="fname" value=""></label><br />',
                    buttons: { Cancel: -1, Done: 1 },
                    focus: 1,
                    submit:function(e,v,m,f){ 
                        var newWeaponID = f.fname+"-weapon-btn";
                        var newDivID = f.fname+"-weapon-div";
                        if (f.fname != "") {      
                            var newButton = jQuery('<div/>', {id: newDivID, 
                                             class: 'btn-group weapon-div'}).html('<button type="button" class="btn btn-default weapon-btn" id=' + newWeaponID + '>'+
	                                     f.fname + '</button>');
                            //click weapon button function by

                            $('#edit-weapon-btn').before(newButton);
                            newButton.click(function(e) {
                                 clickWeaponButton(newWeaponID);
                            });
                            actDictionary[currentSection][currentMove][1][f.fname]= null;
                            currentWeapon = f.fname;
                            clickWeaponButton(newWeaponID);
                        }
			e.preventDefault();
                        if(v==-1) $.prompt.close();
                        if(v==1) $.prompt.close();
                    },
            },
  	};
        $.prompt(newWeaponPrompt);

      });
      

      $('#delete-weapon-button').click( function(e) {
      var currentWeaponList = Object.keys(actDictionary[currentSection][currentMove][1]);
      var selectForm = $("<select></select>");
      $.each(actDictionary[currentSection][currentMove][1], function(key, value) {
        selectForm.append($("<option></option>").attr("value",key).text(key));
      });

      var deleteWeaponPrompt = {
                state0: {
		    title: 'Delete Weapon',
                    html: "<select name = 'dname' id = 'delete-weapon-select' class=selectpicker'>" + selectForm.html() + "</select>",
                    buttons: { Cancel: -1, Done: 1 },
                    focus: 1,
                    submit:function(e,v,m,f){ 

                        if(v==1) {
                            delete actDictionary[currentSection][currentMove][1][f.dname];
                            $("#"+f.dname + "-weapon-div").remove();
                            if (f.dname == currentWeapon){
                                currentWeapon = null;
                                renderVideoPanel();
                            };
                        }
                        
			e.preventDefault();
                        if(v==-1) $.prompt.close();
                        if(v==1) $.prompt.close();
                    },
                   loaded:function(e){
                    $('select').selectpicker();
                   },
            },
  	};
        var actualDeletePrompt = $.prompt(deleteWeaponPrompt);
        actualDeletePrompt.on("impromptu:loaded", function(e){$('select').selectpicker()});
        $.each(actDictionary[currentSection][currentMove][1], function(key, value) {
          jQuery('<div/>', {value: key}).html("<option value='"+key+"'>" + key + "</option>").appendTo("#delete-select");
        });
      });


      $(document).ready(function() {
          $('select').selectpicker();
          populateWeaponList(currentSection, currentMove);

          $("#linkButton").click(function() {
             var linkPrompt =  {
                state0: {
		    title: 'Upload Youtube URL',
                    html:'<label>YoutubeURL <input type="text" name="fname" value=""></label><br />',
                    buttons: { Cancel: -1, Done: 1 },
                    focus: 1,
                    submit:function(e,v,m,f){ 
                        if (f.fname != "") {      
                            embedID = getId(f.fname);
                            actDictionary[currentSection][currentMove][1][currentWeapon] =f.fname;
                            $("#youtubePlugin").attr('src',"http://www.youtube.com/embed/"+embedID);
                            renderVideoPanel();
                        }
			e.preventDefault();
                        if(v==-1) $.prompt.close();
                        if(v==1) $.prompt.close();
                    },
            },
  	};
             $.prompt(linkPrompt);
          });

          $("#uploadButton").click(function() {
             var linkPrompt =  {
                state0: {
		    title: 'Upload File To Youtube',
                    html:'<label>File location <input type="text" name="fname" value=""></label><br />',
                    buttons: { Cancel: -1, Done: 1 },
                    focus: 1,
                    submit:function(e,v,m,f){ 
                        if (f.fname != "") {      
                            embedID = getId("https://www.youtube.com/watch?v=sJgDYdA8dio"); //CANNED
                            actDictionary[currentSection][currentMove][1][currentWeapon] =f.fname;
                            $("#youtubePlugin").attr('src',"http://www.youtube.com/embed/"+embedID);
                            renderVideoPanel();
                        }
			e.preventDefault();
                        if(v==-1) $.prompt.close();
                        if(v==1) $.prompt.close();
                    },
            },
  	};
             $.prompt(linkPrompt);
          });

      renderVideoPanel();
      console.log($("#youtubePlugin").html());
      $("#Sword-weapon-btn").addClass("btn-info");
      });

    </script>
    </body>
    
</html>
      
    
